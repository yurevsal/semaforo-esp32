#include <Arduino.h>
#include <NTPClient.h> 
#include <esp_task_wdt.h>
#include <WiFi.h>
#include <PubSubClient.h>
#include <ArduinoJson.h>
#include <WiFiManager.h>
#include <SPI.h>
#include <Wire.h> 
#include <LiquidCrystal_I2C.h> 
#include "PCF8574.h"
#include "RTClib.h"
#include <vector>
#include <Preferences.h>
#include <ESP32Time.h>
#include "menu.h"
#include "manager.h"
#include <plan.h>
#include <esp32_utils.h>

#define NOME_EMPRESA "Nome Impresa"
#define N_PLAN_MAX 6
#define N_CANAIS_MAX 7
#define FASE_PEDE 8
#define T_CORRIGE_ESP32_RTC 720
#define MAX_MAIN_MENUS 4
#define MAX_SUB_MENUS 2
#define REFRESH_DELAY 100

using namespace std;

#define countof(a) (sizeof(a) / sizeof(a[0]))

#define SCL 22
#define SDA 21
#define BT_UP 27
#define BT_DOWN 32
#define BT_LEFT 26
#define BT_RIGHT 33
#define BT_CENTER 25
#define BT_PEDE 35 // Botoeira dos pedestres

#define SSID "ALPHA"
#define PASSWORD "guide57600"
#define SERVER "3.136.86.252"
#define PORT 1883
#define PUB_TOPIC "{id}/semaforo/teste/{chave}"
#define SUB_TOPIC "{id}/semaforo/teste/{chave}"
#define USER "nodered"
#define PASS "KtaN0Hgkyh"

#define IMAGE_WIDTH 48
#define IMAGE_HEIGHT 48
static unsigned char IMAGE_NAME[288] PROGMEM = {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xc0,0x03,0x00,0x00,0x00,0x00,0xfc,0x3f,0x00,0x00,0x00,0x00,0xfe,0xff,0x00,0x00,
    0x00,0x00,0xf3,0xff,0x01,0x00,0x00,0x00,0xe1,0xff,0x01,0x00,0x00,0x00,0xe1,0xff,
    0x01,0x00,0x00,0x00,0xf3,0xff,0x01,0x00,0x00,0x00,0xff,0xff,0x01,0x00,0x00,0x00,
    0xff,0xff,0x01,0x00,0x00,0x00,0x00,0xff,0x01,0x00,0x00,0xfe,0xff,0xff,0xfd,0x00,
    0x00,0xff,0xff,0xff,0xfd,0x01,0x80,0xff,0xff,0xff,0xfd,0x01,0x80,0xff,0xf1,0xff,
    0xfd,0x03,0xc0,0xff,0xf1,0xff,0xfd,0x03,0xc0,0x3b,0x91,0x93,0xf0,0x07,0xc0,0x13,
    0x01,0x03,0xe0,0x07,0xc0,0x83,0x21,0x22,0xe6,0x07,0xc0,0x87,0x01,0x00,0xe6,0x07,
    0xc0,0xc7,0x00,0x00,0xe6,0x07,0xc0,0x07,0x30,0x32,0xe6,0x07,0xc0,0x03,0x23,0x32,
    0xe6,0x07,0xc0,0x31,0x03,0x33,0xe6,0x07,0xc0,0xbf,0xff,0xff,0xff,0x03,0x80,0xbf,
    0xff,0xff,0xff,0x03,0x80,0xbf,0xff,0xff,0xff,0x01,0x00,0xbf,0xff,0xff,0xff,0x01,
    0x00,0xbe,0xff,0xff,0xff,0x00,0x00,0x80,0xff,0x00,0x00,0x00,0x00,0x80,0xff,0xff,
    0x01,0x00,0x00,0x80,0xff,0xff,0x01,0x00,0x00,0x80,0xff,0xcf,0x01,0x00,0x00,0x80,
    0xff,0x87,0x01,0x00,0x00,0x80,0xff,0x87,0x01,0x00,0x00,0x00,0xff,0xcf,0x01,0x00,
    0x00,0x00,0xfe,0xff,0x00,0x00,0x00,0x00,0xfc,0x3f,0x00,0x00,0x00,0x00,0xc0,0x07,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    };

    // Numero de fases
    // Tipo de Pedestre
    // Ajusta RTC
    // Amarelo Intermitente
    // Conversão
    // Desliga WiFi
    // Planos
    // Segurança